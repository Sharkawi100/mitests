<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mitests - لوحة المعلم المستقل</title>
  <meta name="description" content="لوحة إدارة شخصية للمعلم المستقل: الاختبارات، الطلاب، المجموعات، والإعدادات.">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">

  <style>
    .teacher-navbar { border-bottom: 1px solid var(--color-gray-200); }
    body.rtl .main-content .teacher-navbar { right: var(--sidebar-width); left: 0; }
    body.ltr .main-content .teacher-navbar { left: var(--sidebar-width); right: 0; }
    body.rtl .main-content.main-content--expanded .teacher-navbar { right: var(--sidebar-collapsed-width); }
    body.ltr .main-content.main-content--expanded .teacher-navbar { left: var(--sidebar-collapsed-width); }
    .teacher-navbar .navbar__brand-icon { background: linear-gradient(135deg, var(--color-teacher), var(--color-primary-400)); }

    .sidebar__item:hover, .sidebar__item--active { background: rgba(53, 86, 178, 0.25); color: var(--color-white); }
    .sidebar__item--active { border-inline-start: 3px solid var(--color-teacher); }
    .btn--teacher { background: var(--color-teacher); border-color: var(--color-teacher); color: var(--color-white); }
    .btn--teacher:hover { background: var(--color-primary-600); border-color: var(--color-primary-600); color: var(--color-white); }
    .btn--new-exam { background: linear-gradient(135deg, var(--color-teacher), #4c6fd2); border-color: var(--color-teacher); color: var(--color-white); }
    .btn--new-exam:hover { background: linear-gradient(135deg, var(--color-primary-600), var(--color-primary-500)); color: var(--color-white); }

    .main {
      padding: calc(var(--navbar-height) + var(--space-6)) var(--space-6) var(--space-8);
      display: grid;
      gap: var(--space-5);
    }

    .header-card {
      background: linear-gradient(145deg, rgba(53, 86, 178, 0.13), rgba(255, 255, 255, 1) 60%);
      border: 1px solid var(--color-primary-200);
      border-top: 4px solid var(--color-teacher);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-md);
      padding: var(--space-6);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--space-4);
      flex-wrap: wrap;
    }

    .header-card h1 { color: var(--color-gray-900); font-size: var(--font-size-3xl); margin-bottom: var(--space-2); }
    .header-card p { color: var(--color-gray-600); }

    .tenant-badge {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      background: var(--color-primary-100);
      color: var(--color-teacher);
      border-radius: var(--border-radius-full);
      padding: var(--space-1) var(--space-3);
      font-size: var(--font-size-xs);
      font-weight: 700;
      margin-top: var(--space-2);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: var(--space-3);
    }

    .stat-card {
      border: 1px solid var(--color-gray-200);
      border-top: 4px solid var(--color-teacher);
      border-radius: var(--border-radius-md);
      background: var(--color-white);
      box-shadow: var(--shadow-sm);
      padding: var(--space-4);
      display: grid;
      gap: var(--space-2);
    }

    .stat-card p { color: var(--color-gray-500); font-size: var(--font-size-sm); }
    .stat-card strong { color: var(--color-gray-900); font-size: var(--font-size-2xl); line-height: 1.2; }

    .token-progress {
      width: 100%;
      height: 10px;
      border-radius: var(--border-radius-full);
      background: var(--color-primary-100);
      overflow: hidden;
    }

    .token-progress span {
      display: block;
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, var(--color-teacher), var(--color-primary-400));
      transition: width 0.3s ease;
    }

    .grid {
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: var(--space-4);
    }

    .card-block {
      background: var(--color-white);
      border: 1px solid var(--color-gray-200);
      border-top: 4px solid var(--color-teacher);
      border-radius: var(--border-radius-md);
      box-shadow: var(--shadow-sm);
      padding: var(--space-4);
      display: grid;
      gap: var(--space-3);
    }

    .card-block h2 { color: var(--color-gray-900); font-size: var(--font-size-xl); }

    .group-list { display: grid; gap: var(--space-3); }
    .group-item {
      border: 1px solid var(--color-gray-200);
      border-radius: var(--border-radius-sm);
      padding: var(--space-3);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--space-2);
      flex-wrap: wrap;
    }
    .group-item strong { color: var(--color-gray-800); }
    .group-item span { color: var(--color-gray-500); font-size: var(--font-size-sm); }

    .todo-list { display: grid; gap: var(--space-2); }
    .todo-item {
      border: 1px dashed var(--color-primary-300);
      border-radius: var(--border-radius-sm);
      background: var(--color-primary-100);
      padding: var(--space-3);
      color: var(--color-gray-700);
      font-size: var(--font-size-sm);
    }

    .table-wrap { overflow-x: auto; }
    .data-table { width: 100%; border-collapse: collapse; min-width: 640px; }
    .data-table th, .data-table td {
      padding: var(--space-3);
      border-bottom: 1px solid var(--color-gray-200);
      text-align: start;
      font-size: var(--font-size-sm);
    }
    .data-table th { color: var(--color-gray-500); background: var(--color-gray-50); font-weight: 600; }

    .status-pill {
      display: inline-flex;
      align-items: center;
      border-radius: var(--border-radius-full);
      padding: var(--space-1) var(--space-3);
      font-size: var(--font-size-xs);
      font-weight: 700;
    }
    .status-pill--published { background: var(--color-green-100); color: #166534; }
    .status-pill--draft { background: var(--color-amber-100); color: #9a3412; }

    @media (max-width: 1023px) {
      body.rtl .main-content .teacher-navbar { right: var(--sidebar-collapsed-width); }
      body.ltr .main-content .teacher-navbar { left: var(--sidebar-collapsed-width); }
      body.rtl .main-content { margin-right: var(--sidebar-collapsed-width); }
      body.ltr .main-content { margin-left: var(--sidebar-collapsed-width); }
      .sidebar { width: var(--sidebar-collapsed-width); }
      .sidebar .sidebar__brand-text, .sidebar .sidebar__item span, .sidebar .sidebar__toggle span { display: none; }
      .stats-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .grid { grid-template-columns: 1fr; }
    }

    @media (max-width: 767px) {
      .sidebar { display: none; }
      body.rtl .main-content, body.ltr .main-content { margin: 0; }
      body.rtl .main-content .teacher-navbar, body.ltr .main-content .teacher-navbar { right: 0; left: 0; }
      .main { padding-inline: var(--space-4); }
      .stats-grid { grid-template-columns: 1fr; }
      .header-card h1 { font-size: var(--font-size-2xl); }
    }
  </style>
</head>
<body class="rtl">
  <aside class="sidebar" id="sidebar" aria-label="Sidebar navigation">
    <div class="sidebar__header">
      <div class="sidebar__logo">M</div>
      <span class="sidebar__brand-text">سراج - المعلم المستقل</span>
    </div>
    <nav class="sidebar__nav">
      <a class="sidebar__item sidebar__item--active" href="teacher-personal-dashboard.html" data-teacher-home><i class="fas fa-gauge"></i><span>نظرة عامة</span></a>
      <a class="sidebar__item" href="teacher-exams.html"><i class="fas fa-file-lines"></i><span>اختباراتي</span></a>
      <a class="sidebar__item" href="teacher-group.html"><i class="fas fa-users"></i><span>المجموعات</span></a>
      <a class="sidebar__item" href="teacher-question-bank.html"><i class="fas fa-database"></i><span>بنك الأسئلة</span></a>
      <a class="sidebar__item" href="teacher-settings.html"><i class="fas fa-gear"></i><span>الإعدادات</span></a>
    </nav>
    <button class="sidebar__toggle" id="sidebar-toggle" aria-label="Toggle sidebar"><i class="fas fa-angles-right"></i><span>تصغير</span></button>
  </aside>

  <div class="main-content" id="main-content">
    <nav class="navbar teacher-navbar" role="navigation" aria-label="Teacher top navigation">
      <a href="teacher-personal-dashboard.html" class="navbar__brand" data-teacher-home>
        <div class="navbar__brand-icon"><i class="fas fa-user-tie"></i></div>
        <span class="navbar__brand-text">لوحة المعلم المستقل</span>
      </a>
      <div class="navbar__actions">
        <div class="lang-switcher" role="group" aria-label="Language selector">
          <button class="lang-switcher__btn active" data-lang="ar" aria-label="Arabic">&#1593;</button>
          <button class="lang-switcher__btn" data-lang="he" aria-label="Hebrew">&#1506;&#1489;</button>
          <button class="lang-switcher__btn" data-lang="en" aria-label="English">En</button>
        </div>
        <div class="avatar-dropdown">
          <button class="avatar-btn" type="button" data-avatar-toggle="teacher-avatar-menu" aria-label="قائمة حساب المعلم">
            <i class="fas fa-user"></i>
          </button>
          <div class="avatar-menu" id="teacher-avatar-menu" data-avatar-menu>
            <span class="avatar-menu__label">حساب المعلم</span>
            <a class="avatar-menu__link" href="teacher-profile.html"><i class="fas fa-id-card"></i><span>الملف الشخصي</span></a>
            <a class="avatar-menu__link" href="teacher-settings.html"><i class="fas fa-gear"></i><span>الإعدادات</span></a>
          </div>
        </div>
        <a href="index.html" class="btn btn--teacher btn--sm"><i class="fas fa-right-from-bracket"></i><span>تسجيل الخروج</span></a>
      </div>
    </nav>

    <main class="main">
      <header class="header-card">
        <div>
          <h1 id="welcome-title">مرحبًا، معلّم مستقل</h1>
          <p>هذه مساحة إدارتك الشخصية. يمكنك إدارة طلابك، مجموعاتك، واختباراتك بدون إعدادات مدرسة مركزية.</p>
          <div class="tenant-badge" data-tenant-badge><i class="fas fa-user-tie"></i><span>وضع المعلم المستقل</span></div>
        </div>
        <a href="exam-wizard.html" class="btn btn--new-exam btn--lg"><i class="fas fa-plus"></i><span>إنشاء اختبار جديد +</span></a>
      </header>

      <section class="stats-grid">
        <article class="stat-card">
          <p>استهلاك التوكنز</p>
          <strong id="token-text">0 / 0</strong>
          <div class="token-progress"><span id="token-bar"></span></div>
        </article>
        <article class="stat-card"><p>الطلاب النشطون</p><strong id="students-count">0</strong></article>
        <article class="stat-card"><p>المجموعات النشطة</p><strong id="groups-count">0</strong></article>
        <article class="stat-card"><p>اختبارات هذا الشهر</p><strong id="exams-count">0</strong></article>
      </section>

      <section class="grid">
        <article class="card-block">
          <h2>مجموعاتي</h2>
          <div class="group-list">
            <div class="group-item"><div><strong>مجموعة القراءة - المستوى 1</strong><span>16 طالبًا</span></div><a class="btn btn--teacher btn--sm" href="teacher-group.html?g=grade7-eng">فتح المجموعة</a></div>
            <div class="group-item"><div><strong>مجموعة الجبر - المستوى 2</strong><span>14 طالبًا</span></div><a class="btn btn--teacher btn--sm" href="teacher-group.html?g=grade8-math">فتح المجموعة</a></div>
            <div class="group-item"><div><strong>مجموعة العلوم التطبيقية</strong><span>18 طالبًا</span></div><a class="btn btn--teacher btn--sm" href="teacher-group.html?g=grade10-sci">فتح المجموعة</a></div>
          </div>
        </article>

        <article class="card-block">
          <h2>مهام سريعة</h2>
          <div class="todo-list">
            <div class="todo-item">متبقي 2 اختبارات تحتاج نشرًا للطلاب.</div>
            <div class="todo-item">3 أسئلة محفوظة في بنك الأسئلة ولم تُستخدم بعد.</div>
            <div class="todo-item">تقرير أداء مجموعة القراءة جاهز للمراجعة.</div>
          </div>
          <div>
            <a class="btn btn--teacher btn--sm" href="teacher-question-bank.html"><i class="fas fa-database"></i><span>إدارة بنك الأسئلة</span></a>
          </div>
        </article>
      </section>

      <section class="card-block">
        <h2>آخر الاختبارات</h2>
        <div class="table-wrap">
          <table class="data-table">
            <thead>
              <tr>
                <th>العنوان</th>
                <th>التاريخ</th>
                <th>الحالة</th>
                <th>الإجراء</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>اختبار المفردات - مستوى 1</td>
                <td>2026-02-11</td>
                <td><span class="status-pill status-pill--published">منشور</span></td>
                <td><a class="btn btn--teacher btn--sm" href="exam-report.html">النتائج</a></td>
              </tr>
              <tr>
                <td>اختبار الجبر - وحدة الكسور</td>
                <td>2026-02-08</td>
                <td><span class="status-pill status-pill--draft">مسودة</span></td>
                <td><a class="btn btn--teacher btn--sm" href="exam-report.html">النتائج</a></td>
              </tr>
              <tr>
                <td>اختبار العلوم - التجربة المعملية</td>
                <td>2026-02-05</td>
                <td><span class="status-pill status-pill--published">منشور</span></td>
                <td><a class="btn btn--teacher btn--sm" href="exam-report.html">النتائج</a></td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <script src="shared-layout.js"></script>
  <script src="tenant-mode.js"></script>
  <script>
    (function () {
      'use strict';

      try {
        localStorage.setItem('mitests-tenant-type', 'personal_teacher');
      } catch (e) {}

      var defaults = {
        tokenLimit: 10000,
        tokenUsed: 2300,
        groups: 3,
        students: 48,
        examsMonth: 7
      };

      var workspace = defaults;
      var profile = { name: 'معلّم مستقل' };

      try {
        var rawWorkspace = localStorage.getItem('mitests-personal-workspace');
        if (rawWorkspace) {
          var parsed = JSON.parse(rawWorkspace);
          if (parsed && typeof parsed === 'object') workspace = parsed;
        }
        var rawProfile = localStorage.getItem('mitests-personal-teacher-profile');
        if (rawProfile) {
          var parsedProfile = JSON.parse(rawProfile);
          if (parsedProfile && typeof parsedProfile === 'object') profile = parsedProfile;
        }
      } catch (e) {}

      var tokenLimit = Number(workspace.tokenLimit) || defaults.tokenLimit;
      var tokenUsed = Number(workspace.tokenUsed) || defaults.tokenUsed;
      var tokenRemaining = Math.max(0, tokenLimit - tokenUsed);
      var tokenPct = tokenLimit > 0 ? Math.round((tokenUsed / tokenLimit) * 100) : 0;

      var welcomeTitle = document.getElementById('welcome-title');
      var tokenText = document.getElementById('token-text');
      var tokenBar = document.getElementById('token-bar');
      var studentsCount = document.getElementById('students-count');
      var groupsCount = document.getElementById('groups-count');
      var examsCount = document.getElementById('exams-count');

      if (welcomeTitle) {
        welcomeTitle.textContent = 'مرحبًا، ' + (profile.name || 'معلّم مستقل');
      }
      if (tokenText) {
        tokenText.textContent = tokenRemaining.toLocaleString() + ' / ' + tokenLimit.toLocaleString();
      }
      if (tokenBar) {
        tokenBar.style.width = tokenPct + '%';
      }
      if (studentsCount) {
        studentsCount.textContent = String(Number(workspace.students) || defaults.students);
      }
      if (groupsCount) {
        groupsCount.textContent = String(Number(workspace.groups) || defaults.groups);
      }
      if (examsCount) {
        examsCount.textContent = String(Number(workspace.examsMonth) || defaults.examsMonth);
      }
    })();
  </script>
</body>
</html>

