# Mitests.com - Requirement Analysis (RA) v2.8

## 1) مقدمة ورؤية المنتج
Mitests هي منصة تقييم تعليمي مدعومة بالذكاء الاصطناعي، تهدف إلى تحويل الاختبار من عبء تشغيلي إلى أداة تعلم قابلة للقياس.

**الشعار:** وراء كل اختبار، إنسان.

## 2) النطاق (Scope)
النطاق الحالي يغطي تجربة Demo متعددة الأدوار:
1. Admin (إدارة المنصة)
2. School (إدارة المؤسسة التعليمية)
3. Teacher (المعلم ضمن مدرسة)
4. Personal Teacher (معلم مستقل)
5. Student (الطالب)

مع دعم واجهات متعددة اللغات (ar/he/en) وRTL/LTR.

## 3) مبادئ تنظيم المسؤوليات
### 3.1 مستوى الإدارة العامة (Admin-Level)
يشمل فقط ما هو مركزي على مستوى المنصة:
- مزودو الذكاء الاصطناعي وسياسات Fallback.
- مكتبة البرومبت المركزية.
- إدارة الخطط والاشتراكات.
- إدارة سجل المدارس.
- كتالوج مركزي للمراحل والمواد.
- مؤشرات وتقارير على مستوى المنصة.

### 3.2 مستوى المدرسة (School-Level)
يشمل ما يخص كل مدرسة على حدة:
- الملف المؤسسي التفصيلي.
- إدارة المستخدمين داخل المدرسة.
- إدارة التوكنز وتوزيعها.
- الهوية المؤسسية (White Label) الخاصة بالمدرسة.
- تدقيق/مراجعة الاختبارات داخل المدرسة.
- التواصل والإشعارات داخل المدرسة.

### 3.3 قرارات الحوكمة
- White Label على مستوى المدرسة وليس Admin.
- QA التشغيلي التفصيلي على مستوى المدرسة (قابلية التوسع لـ 300+ مدرسة).
- Admin يركز على السياسات والقياس الكلي، وليس التشغيل اليومي لكل مدرسة.

## 4) خريطة الصفحات (Information Architecture)
> التنقل الأساسي يعتمد صفحات مستقلة `*.html` بدون روابط `#section`.

### 4.1 صفحات عامة
- `index.html`: الصفحة الرئيسية + اختيار الدور.

### 4.2 Admin
- `admin-dashboard.html`: نظرة عامة مركزية.
- `admin-ai-config.html`: إعدادات AI.
- `admin-prompt-library.html`: مكتبة البرومبت.
- `admin-plans.html`: الباقات والخطط.
- `admin-schools.html`: إدارة المدارس.
- `admin-settings.html`: إعدادات إدارية عامة.
- `admin-grades-catalog.html`: كتالوج المراحل.
- `admin-subjects-catalog.html`: كتالوج المواد.
- `admin-profile.html`: ملف المدير.

### 4.3 School
- `school.html`: لوحة المدرسة.
- `school-profile.html`: الملف المؤسسي.
- `school-tokens.html`: إدارة التوكنز.
- `school-users-teachers.html`: إدارة المعلمين.
- `school-users-students.html`: إدارة الطلاب.
- `school-users-staff.html`: إدارة الموظفين.
- `school-qa-review.html`: مراجعة الاختبارات.
- `school-exam-comparison.html`: مقارنة الاختبارات والمجموعات.
- `school-approval.html`: اعتماد المحتوى.
- `school-communications.html`: التواصل والإشعارات.
- `school-settings.html`: إعدادات المدرسة.
- `school-whitelabel.html`: الهوية المؤسسية.

### 4.4 Teacher
- `teacher-dashboard.html`: لوحة المعلم (مدرسي).
- `teacher-personal-dashboard.html`: لوحة المعلم المستقل.
- `teacher-exams.html`: اختباراتي.
- `exam-wizard.html`: معالج إنشاء الاختبار.
- `exam-assessment.html`: اعتماد/تعديل تقييم AI.
- `exam-report.html`: تقرير المجموعة.
- `teacher-group.html`: إدارة المجموعات.
- `teacher-question-bank.html`: بنك الأسئلة.
- `teacher-settings.html`: إعدادات المعلم.
- `teacher-profile.html`: الملف الشخصي.

### 4.5 Student
- `student-dashboard.html`: لوحة الطالب.
- `student-coming-tests.html`: الاختبارات القادمة.
- `student-groups.html`: مجموعاتي + الانضمام بالكود.
- `student-group-detail.html`: تفاصيل مجموعة.
- `student-learning.html`: مسار التعلم.
- `student-reports.html`: تقارير حديثة.
- `student-feedback.html`: صفحة الملاحظات (Canonical).
- `student-exam.html`: واجهة أداء الاختبار.
- `student-settings.html`: إعدادات الطالب.
- `student-profile.html`: الملف الشخصي.

## 5) المتطلبات الوظيفية الأساسية

### 5.1 إدارة المدارس (Admin Schools)
#### 5.1.1 إنشاء مدرسة جديدة
حقول الإضافة الأساسية:
- أيقونة/شعار المؤسسة (اختياري).
- رمز المؤسسة التعليمية.
- اسم المؤسسة.
- البريد الإلكتروني للمؤسسة (إلزامي).
- المراحل التعليمية للمؤسسة (تُسحب من الكتالوج المركزي).

#### 5.1.2 ملف المؤسسة
حقول الملف المؤسسي:
- الدولة.
- العنوان.
- الهاتف.
- روابط التواصل الاجتماعي.
- اللغة الافتراضية.
- بيانات الهوية المؤسسية.

### 5.2 كتالوج المراحل والمواد (Admin Catalog)
- إدارة بقوائم فعلية (وليس Textarea بفواصل).
- إضافة عنصر واحد بزر إضافة.
- عرض فوري لجميع العناصر.
- تعديل/حذف العناصر.
- حفظ مركزي لاستهلاكه في صفحات المدارس والمعلمين.

### 5.3 إدارة المستخدمين (School Users)
#### 5.3.1 المعلمون
- إضافة/تعديل/تصفية.
- الصفوف والتخصصات والصلاحيات.
- المدرسة يمكنها ربط المعلم بأكثر من مادة (Multi-subject assignment).

#### 5.3.2 الطلاب
- إضافة/تعديل/حذف الطالب.
- البيانات الأساسية: الاسم، الصف، الشعبة، رقم ولي الأمر.
- حفظ البيانات بشكل قابل للاستهلاك من إدارة المجموعات.

#### 5.3.3 الموظفون
- أدوار تشغيلية واضحة (Admin/Secretary/Supervisor/Accountant).
- مصفوفة صلاحيات دقيقة.

### 5.4 التوكنز
- رصيد ديناميكي للمدرسة.
- سجل حركات (Transaction History).
- تخصيص رصيد للمعلمين.

### 5.5 وضعا المعلم (School vs Personal)
- النظام يدعم نمطين:
1. `school_teacher`: ضمن مؤسسة.
2. `personal_teacher`: مساحة مستقلة.
- عزل البيانات حسب النمط (Tenant-aware storage).
- تحويل روابط الواجهة المنزلية تلقائيًا حسب النمط.

### 5.6 إدارة المجموعات والانضمام (Teacher/Student)
#### 5.6.1 إدارة المجموعات (Teacher)
- إنشاء/تعديل/حذف/فتح المجموعة.
- تعريف: اسم المجموعة، المادة، الصف، الشعبة.
- كود انضمام لكل مجموعة مع:
  - نسخ الكود.
  - تدوير (Rotate) الكود.
- **إدارة الموارد (Resources):**
  - دعم إرفاق ملفات (PDF, DOCX, Video) مع تحويلها لـ DataURL (لأغراض العرض).
  - دعم روابط ويب (Web Links) مع اكتشاف تلقائي وتضمين لروابط يوتيوب (YouTube Embed).
  - إضافة ملاحظات (Notes) لكل مورد.
  - عرض حجم الملف وتنسيقه (KB/MB).

#### 5.6.2 طلبات الانضمام
- الطالب يرسل طلب انضمام عبر كود.
- المعلم يرى الطلبات المعلقة ويقوم بـ:
  - موافقة.
  - رفض.

#### 5.6.3 سجل الحالات (History)
- كل قرار (Approved/Rejected) يُسجل بتاريخ القرار.
- الطالب يرى:
  - الطلبات المعلقة.
  - سجل الطلبات السابقة مع الحالة.

#### 5.6.4 ربط المدرسة بالمجموعات (Auto-enroll)
- في وضع المدرسة: يمكن مزامنة الطلاب تلقائيًا للمجموعة حسب:
  - الصف.
  - الشعبة (إن وُجدت).

#### 5.6.5 لوحة مهام المعلم (Teacher Tasks)
- يجب أن تعرض لوحة المعلم إجابة مباشرة على:
  - ما الاختبار/الواجب الذي يحتاج مراجعة؟
  - أي طالب مرتبط بكل عنصر مراجعة؟
  - من الطلاب المعتمدون ومن بانتظار الاعتماد؟
- مكونات صفحة المهام داخل لوحة المعلم:
  - عدّاد `New Group Member`.
  - عدّاد `New Share`.
  - عدّاد `New Student/s Assigned`.
  - جدول `Review Queue` يتضمن: النوع، العنوان، المجموعة، الطالب، الحالة، زر المراجعة.
  - قسم اعتماد الطلاب: Pending مقابل Approved.

### 5.7 معالج الاختبار (Exam Wizard)
المعالج يعمل عبر 4 خطوات:
1. General Info
2. Content Source
3. AI Structure
4. Review & Generate

المتطلبات:
- إضافة حقل إلزامي `نوع التقييم`: `اختبار` أو `واجب`.
- التدفق واحد لكلا النوعين (نفس الـ Wizard ونفس التقييم)، مع اختلاف التصنيف.
- مصادر المحتوى: رفع ملف / توليد AI / اختبار بدون نص (توليد AI مباشر) / إدخال يدوي (بدون AI).
- عند توليد AI: حقل "النمط" Dropdown: `قصة`، `حوار`، `قطعة علمية`، `مقال`.
- أنواع الأسئلة المدعومة: `MC` (اختيار من متعدد)، `True/False` (صح/خطأ)، `Matching` (مطابقة)، `Completion` (إكمال)، `Short Answer` (إجابة قصيرة)، `Open-end` (مقال).
- دعم مستوى صعوبة `Mixed` (مختلط) يوزع الأسئلة بين Easy/Medium/Hard.
- الحالة الافتراضية للاختبار عند الإنشاء هي `Draft` (مسودة).
- عند Generate: يظهر Processing Overlay ثم انتقال لصفحة `Answer Key Preview` (ليس Dashboard مباشرة).

#### 5.7.2 تحليل الملف عبر مزود AI واقتراح خطة المعالجة
- عند رفع ملف في معالج الاختبار، يقوم النظام بتحليل الملف عبر مزود AI.
- يعرض النظام اقتراحات تشغيلية مثل:
  - تحويل المحتوى إلى قاعدة أسئلة.
  - توليد اختبار مشابه من نفس المادة/المستوى.
  - استخراج نواتج التعلم وبناء مخطط اختبار.
  - اقتراحات إضافية حسب نوع وحجم الملف.
- يختار المعلم خطة المعالجة قبل المتابعة.

#### 5.7.3 وضع "اختبار بدون نص" (AI Direct)
- بديل للوضع اليدوي التقليدي.
- يتيح إنشاء اختبار بدون نص تمهيدي عبر AI مباشرة.
- يدعم تحديد:
  - هدف الاختبار.
  - نوع التركيز (مفاهيم/تطبيق/مختلط).
  - تعليمات إضافية للذكاء الاصطناعي.

#### 5.7.1 جدولة الاختبار والتحقق من التعارض
- عند إنشاء عنصر من نوع `اختبار` يجب تحديد:
  - تاريخ الاختبار (يجب أن يكون تاريخًا مستقبليًا Valid Future Date).
  - وقت بدء الاختبار.
- النظام يفحص الاختبارات المجدولة ضمن نفس الـ tenant scope.
- إذا وجد:
  - تعارض مباشر (تداخل زمني) أو موعد قريب (±24 ساعة).
  - يجب عرض تنبيه أيقونة حمراء (Red Alert) وتفاصيل عند النقر.
  - لا يمنع الحفظ (Soft Warning).

#### 5.7.4 قواعد التحقق والقفل (Validation & Locking)
- **منع التعديل (Locking):**
  - بمجرد استلام أول تسليم طلابي (Submission)، يتم قفل الاختبار.
  - تظهر رسالة "Locked" ويتم تعطيل التعديل على الأسئلة والإعدادات.
- **الجدولة:** منع اختيار تاريخ ماضي.

### 5.8 التقييم والتقرير
- `exam-assessment.html` يعرض:
  - AI Suggested Grade مقابل Teacher Confirmed Grade.
  - مراجعة كل سؤال + تفسير AI.
  - تعديل يدوي/اعتماد.
  - ملاحظة المعلم.
- داخل "ملاحظة المعلم" يمكن للـ AI توليد:
  - ملخص قصير.
  - نصائح.
  - توصيات.
- يجب دعم تمرير سياق العنصر من الـ Wizard/Tasks:
  - `kind` (exam/assignment)
  - `title`
  - `student`
  - `group`
- Finalize ينقل إلى `exam-report.html`.

### 5.9 تجربة الطالب داخل الاختبار
- Focus Mode بدون Sidebar.
- عداد زمني ثابت مع تحذير أحمر في آخر 5 دقائق.
- Lockdown تحذيري عبر `visibilitychange`.
- Autosave indicator.
- دعم LaTeX.

### 5.10 حذف الاختبارات وسلة المحذوفات
- حذف الاختبار من قائمة المعلم يكون حذفًا ناعمًا (Soft Delete).
- يتم نقل الاختبار إلى سلة محذوفات خاصة بالمعلم لمدة `30` يومًا.
- خلال فترة الـ 30 يوم:
  - يمكن استعادة الاختبار.
  - يمكن حذف الاختبار نهائيًا يدويًا.
- بعد انتهاء 30 يوم يتم حذف السجل تلقائيًا من السلة.

### 5.11 مشاركة الاختبارات بين المعلمين (School Internal Sharing)
- المعلم داخل المدرسة يمكنه مشاركة الاختبار مع معلمين آخرين في نفس المدرسة.
- المعلم المستلم يملك صلاحيتين فقط:
  - Preview (معاينة فقط).
  - Duplicate (نسخ إلى اختباراته).
- النسخة المشتركة الأصلية تكون Read-only للمعلمين الآخرين (لا تعديل مباشر على الأصل).

### 5.12 مقارنة الاختبارات/المجموعات (School Dashboard)
- توفر لوحة المدرسة خيارًا لفتح صفحة مقارنة مستقلة.
- الصفحة تدعم مقارنة عنصرين أو أكثر.
- أنماط المقارنة المدعومة:
  - مقارنة اختبارات.
  - مقارنة مجموعات.
  - مقارنة أزواج اختبار × مجموعة.
- مخرجات المقارنة تشمل:
  - متوسط الدرجات.
  - نسبة النجاح.
  - نسبة الإكمال.
  - عدد التسليمات.

## 6) السلوك التقني (Demo Data Contract)
### 6.1 مفاتيح التخزين (localStorage)
- `mitests-tenant-type`
- `mitests-school-id`
- `mitests-personal-workspace`
- `mitests-teacher-groups:<scope>`
- `mitests-group-join-requests:<scope>`
- `mitests-group-memberships:<scope>`
- `mitests-group-join-history:<scope>`
- `mitests-school-students:<scope>`
- `mitests-current-student-profile:<scope>`
- `mitests-teacher-review-queue:<scope>`
- `mitests-teacher-shares:<scope>`
- `mitests-teacher-exams:<scope>`
- `mitests-teacher-exams-trash:<scope>`
- `mitests-school-exam-comparison:<scope>`

### 6.2 قاعدة العزل
- `<scope>` = `school:<schoolId>` أو `personal:<workspaceId>`.
- يمنع تداخل بيانات المدرسة مع بيانات المعلم المستقل.

## 7) التدفقات الأساسية (End-to-End Flows)
### 7.1 Admin
1. الدخول كمدير.
2. ضبط Catalog (Grades/Subjects).
3. إدارة المدارس والخطط وAI.

### 7.2 School
1. تحديث الملف المؤسسي.
2. إدارة المستخدمين والتوكنز.
3. مراجعة واعتماد محتوى المدرسة.

### 7.3 Teacher (School)
1. إدارة المجموعات وكودات الانضمام.
2. مراجعة/اعتماد طلبات الطلاب.
3. متابعة لوحة المهام (Review Queue + Pending/Approved).
4. إنشاء اختبار/واجب -> تقييم -> تقرير.

### 7.4 Teacher (Personal)
1. الدخول كمعلم مستقل.
2. إدارة مجموعات وطلاب المساحة الشخصية.
3. متابعة المهام بنفس نموذج School (مع عزل البيانات).
4. إنشاء الاختبارات/الواجبات ومتابعة النتائج.

### 7.5 Student
1. حفظ بيانات الطالب.
2. الانضمام بكود مجموعة.
3. متابعة حالة الطلب (Pending/Approved/Rejected).
4. أداء الاختبارات ومراجعة الملاحظات.

## 8) متطلبات UX/NFR
- العربية هي الافتراضي.
- دعم he/ar/en مع RTL/LTR.
- توحيد المكونات (Sidebar/Navbar/Cards/Tables/Modals).
- منع روابط `#` في التنقل الأساسي.
- قابلية توسع لـ 300+ مدرسة.
- جاهزية تكامل Backend لاحقًا.

## 9) Backlog (المرحلة القادمة)
- مركز محادثة وإشعارات موحد مع صلاحيات دقيقة (School/Teacher/Student).
- توحيد جميع Popups (بدل أي تفاعلات بدائية).
- تعريف تشغيلي واضح لزر "استخدام في اختبار" داخل بنك الأسئلة.
- توسيع سجل القرارات ليشمل سبب الرفض القابل للتحرير.

## 10) معايير القبول (Acceptance Checklist)
- [ ] الفصل واضح بين Admin وSchool وظيفيًا.
- [ ] الكتالوج المركزي يعمل كقوائم CRUD فعلية.
- [ ] تدفق الاختبار يعمل: Wizard -> Assessment -> Report.
- [ ] جميع الروابط الأساسية صفحات مستقلة بدون `#`.
- [ ] دعم ar/he/en مع RTL/LTR على جميع الواجهات.
- [ ] جميع أزرار Logout تعود إلى `index.html`.
- [ ] إدارة الطلاب في المدرسة تحفظ بيانات قابلة للاستهلاك من المجموعات.
- [ ] انضمام الطالب بالمجموعات يعمل بالكود مع موافقة/رفض من المعلم.
- [ ] سجل طلبات الطالب يعرض Pending + History (Approved/Rejected).
- [ ] عزل بيانات tenant يعمل بين المدرسة والمعلم المستقل.
- [ ] لوحة المعلم تعرض Review Queue واضحًا: ما المطلوب مراجعته ولأي طالب.
- [ ] لوحة المعلم تعرض Pending vs Approved للطلاب بوضوح.
- [ ] معالج الاختبار يدعم تصنيف العنصر كـ Exam أو Assignment بنفس التدفق.
- [ ] عند جدولة الاختبار يتم التحقق من التعارض/القرب الزمني مع تنبيه المعلم.
- [ ] المدرسة يمكنها تعيين أكثر من مادة للمعلم في شاشة إدارة المعلمين.
- [ ] حذف الاختبار ينقل العنصر إلى سلة محذوفات 30 يومًا مع استعادة/حذف نهائي.
- [ ] ملاحظة المعلم تدعم توليد AI لملخص/نصائح/توصيات.
- [ ] مشاركة الاختبارات بين المعلمين تدعم Preview + Duplicate مع منع التعديل على الأصل.
- [ ] رفع الملف في المعالج يعرض اقتراحات AI لخطة المعالجة (DB/Similar/Outcomes/...).
- [ ] دعم وضع "اختبار بدون نص" كتوليد AI مباشر بدل الوضع اليدوي.
- [ ] لوحة المدرسة تدعم مقارنة عنصرين أو أكثر في صفحة مستقلة (اختبارات/مجموعات/أزواج).

---

**Document Status:** Updated (v2.8) - Enhanced Exam Wizard (Draft status, Question Types, Preview flow) and Group Resources (Attachments, YouTube).
