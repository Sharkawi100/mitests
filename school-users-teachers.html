<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mitests - إدارة المعلمين</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Cairo', sans-serif; }
    h1, h2, h3, h4, h5, h6 { font-family: 'Cairo', sans-serif; }
    .school-navbar { border-bottom: 1px solid var(--color-gray-200); }
    body.rtl .main-content .school-navbar { right: var(--sidebar-width); left: 0; }
    body.ltr .main-content .school-navbar { left: var(--sidebar-width); right: 0; }
    body.rtl .main-content.main-content--expanded .school-navbar { right: var(--sidebar-collapsed-width); }
    body.ltr .main-content.main-content--expanded .school-navbar { left: var(--sidebar-collapsed-width); }
    .school-navbar .navbar__brand-icon { background: linear-gradient(135deg, var(--color-school), #fbbf24); }
    .sidebar__item:hover, .sidebar__item--active { background: rgba(245, 158, 11, 0.24); color: var(--color-white); }
    .sidebar__item--active { border-inline-start: 3px solid var(--color-school); }
    .btn--school { background: var(--color-school); border-color: var(--color-school); color: var(--color-white); }

    .main { padding: calc(var(--navbar-height) + 1px) 0 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
    
    .page-header { background: var(--color-white); padding: var(--space-4) var(--space-6); border-bottom: 1px solid var(--color-gray-200); }
    .page-header h1 { font-size: var(--font-size-2xl); color: var(--color-gray-900); }
    .page-header p { color: var(--color-gray-500); margin-top: var(--space-1); }

    .tabs-nav { display: flex; gap: var(--space-4); margin-top: var(--space-4); border-bottom: 1px solid var(--color-gray-200); }
    .tab-link {
      padding: var(--space-2) var(--space-4); color: var(--color-gray-500); text-decoration: none; font-weight: 500;
      border-bottom: 2px solid transparent; transition: all 0.2s;
    }
    .tab-link:hover { color: var(--color-school); background: var(--color-gray-50); }
    .tab-link.active { color: var(--color-school); border-bottom-color: var(--color-school); font-weight: 700; }

    .content-area { flex: 1; padding: var(--space-6); overflow-y: auto; display: grid; gap: var(--space-4); }

    .card { background: var(--color-white); border: 1px solid var(--color-gray-200); border-radius: var(--border-radius-md); box-shadow: var(--shadow-sm); padding: var(--space-4); }
    
    .toolbar { display: flex; justify-content: space-between; gap: var(--space-4); flex-wrap: wrap; margin-bottom: var(--space-4); }
    .search-box { flex: 1; max-width: 400px; position: relative; }
    .search-box input { width: 100%; padding: var(--space-2) var(--space-3) var(--space-2) var(--space-7); border: 1px solid var(--color-gray-300); border-radius: var(--border-radius-sm); }
    .search-box i { position: absolute; right: var(--space-3); top: 50%; transform: translateY(-50%); color: var(--color-gray-400); }

    .table-wrap { overflow-x: auto; }
    .data-table { width: 100%; border-collapse: collapse; white-space: nowrap; }
    .data-table th { background: var(--color-gray-50); padding: var(--space-3); text-align: start; font-size: var(--font-size-xs); font-weight: 700; color: var(--color-gray-500); text-transform: uppercase; }
    .data-table td { padding: var(--space-3); border-bottom: 1px solid var(--color-gray-100); font-size: var(--font-size-sm); color: var(--color-gray-700); }
    .data-table tr:hover { background: var(--color-gray-50); }
    
    .status-badge { padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; }
    .status-active { background: #dcfce7; color: #166534; }
    .status-inactive { background: #f3f4f6; color: #374151; }

    .btn-icon { width: 32px; height: 32px; display: inline-flex; align-items: center; justify-content: center; border-radius: 4px; border: 1px solid transparent; color: var(--color-gray-500); cursor: pointer; transition: all 0.2s; }
    .btn-icon:hover { background: var(--color-gray-100); color: var(--color-gray-900); }
    .btn-icon.edit:hover { background: #eff6ff; color: #1d4ed8; }
    .btn-icon.delete:hover { background: #fef2f2; color: #b91c1c; }

    /* Modal Styles */
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000;
      display: none; align-items: center; justify-content: center; backdrop-filter: blur(2px);
    }
    .modal-overlay[aria-hidden="false"] { display: flex; animation: fadeIn 0.2s ease-out; }
    .modal {
      background: var(--color-white); width: 100%; max-width: 500px;
      border-radius: var(--border-radius-lg); box-shadow: var(--shadow-xl); overflow: hidden;
      display: flex; flex-direction: column; max-height: 90vh; /* Fix overflow */
      animation: slideUp 0.3s ease-out;
    }
    .modal__header {
      padding: var(--space-4); border-bottom: 1px solid var(--color-gray-200);
      display: flex; justify-content: space-between; align-items: center; background: var(--color-gray-50);
    }
    .modal__header h2 { font-size: var(--font-size-lg); margin: 0; color: var(--color-gray-800); }
    .modal__close { background: none; border: none; font-size: var(--font-size-xl); cursor: pointer; color: var(--color-gray-500); }
    .modal__body { padding: var(--space-5); display: grid; gap: var(--space-4); overflow-y: auto; }
    
    .form-group { display: grid; gap: var(--space-1); }
    .form-group label { font-size: var(--font-size-sm); font-weight: 600; color: var(--color-gray-700); }
    .form-group input, .form-group select {
      padding: var(--space-2) var(--space-3); border: 1px solid var(--color-gray-300);
      border-radius: var(--border-radius-sm); font-family: inherit;
    }
    .modal__footer {
      padding: var(--space-4); border-top: 1px solid var(--color-gray-200);
      display: flex; justify-content: flex-end; gap: var(--space-3); background: var(--color-gray-50);
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    @media (max-width:1023px){ body.rtl .main-content .school-navbar{right:var(--sidebar-collapsed-width)} body.ltr .main-content .school-navbar{left:var(--sidebar-collapsed-width)} body.rtl .main-content{margin-right:var(--sidebar-collapsed-width)} body.ltr .main-content{margin-left:var(--sidebar-collapsed-width)} .sidebar{width:var(--sidebar-collapsed-width)} .sidebar .sidebar__brand-text,.sidebar .sidebar__item span,.sidebar .sidebar__toggle span{display:none} }
    @media (max-width:767px){ .sidebar{display:none} body.rtl .main-content,body.ltr .main-content{margin:0} body.rtl .main-content .school-navbar,body.ltr .main-content .school-navbar{right:0;left:0} .tabs-nav { overflow-x: auto; } }
  </style>
</head>
<body class="rtl">
  <aside class="sidebar" id="sidebar" aria-label="Sidebar navigation">
    <div class="sidebar__header"><div class="sidebar__logo">M</div><span class="sidebar__brand-text">سراج - المدرسة</span></div>
    <nav class="sidebar__nav">
      <a class="sidebar__item" href="school.html"><i class="fas fa-gauge"></i><span>نظرة عامة</span></a>
      <a class="sidebar__item" href="school-tokens.html"><i class="fas fa-coins"></i><span>إدارة التوكنز</span></a>
      <a class="sidebar__item sidebar__item--active" href="school-users-teachers.html"><i class="fas fa-user-plus"></i><span>إدارة المستخدمين</span></a>
      <a class="sidebar__item" href="school-profile.html"><i class="fas fa-id-card"></i><span>ملف المؤسسة</span></a>
      <a class="sidebar__item" href="school-whitelabel.html"><i class="fas fa-palette"></i><span>الهوية المؤسسية</span></a>
      <a class="sidebar__item" href="school-qa-review.html"><i class="fas fa-clipboard-check"></i><span>تدقيق الاختبارات</span></a>
      <a class="sidebar__item" href="school-approval.html"><i class="fas fa-badge-check"></i><span>اعتماد المحتوى</span></a>
      <a class="sidebar__item" href="school-communications.html"><i class="fas fa-comments"></i><span>التواصل والإشعارات</span></a>
      <a class="sidebar__item" href="school-settings.html"><i class="fas fa-gear"></i><span>الإعدادات</span></a>
    </nav>
    <button class="sidebar__toggle" id="sidebar-toggle" aria-label="Toggle sidebar"><i class="fas fa-angles-right"></i><span>تصغير</span></button>
  </aside>

  <div class="main-content" id="main-content">
    <nav class="navbar school-navbar" role="navigation" aria-label="School top navigation">
      <a href="school-users-teachers.html" class="navbar__brand"><div class="navbar__brand-icon"><i class="fas fa-chalkboard-user"></i></div><span class="navbar__brand-text">إدارة المعلمين</span></a>
      <div class="navbar__actions">
        <div class="lang-switcher" role="group" aria-label="Language selector"><button class="lang-switcher__btn active" data-lang="ar" aria-label="Arabic">&#1593;</button><button class="lang-switcher__btn" data-lang="he" aria-label="Hebrew">&#1506;&#1489;</button><button class="lang-switcher__btn" data-lang="en" aria-label="English">En</button></div>
        <div class="avatar-dropdown"><button class="avatar-btn" type="button" data-avatar-toggle="school-avatar-menu" aria-label="قائمة حساب المدرسة"><i class="fas fa-building-columns"></i></button><div class="avatar-menu" id="school-avatar-menu" data-avatar-menu><span class="avatar-menu__label">حساب المدرسة</span><a class="avatar-menu__link" href="school-profile.html"><i class="fas fa-id-card"></i><span>ملف المؤسسة</span></a><a class="avatar-menu__link" href="school-settings.html"><i class="fas fa-gear"></i><span>الإعدادات</span></a></div></div>
        <a href="index.html" class="btn btn--school btn--sm"><i class="fas fa-right-from-bracket"></i><span>تسجيل الخروج</span></a>
      </div>
    </nav>

    <main class="main">
      <header class="page-header">
        <h1>إدارة المستخدمين</h1>
        <div class="tabs-nav">
          <a href="school-users-teachers.html" class="tab-link active">المعلمون</a>
          <a href="school-users-students.html" class="tab-link">الطلاب</a>
          <a href="school-users-staff.html" class="tab-link">الموظفون والإداريون</a>
        </div>
      </header>
      
      <div class="content-area">
        <div class="card">
          <div class="toolbar">
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input type="text" placeholder="بحث باسم المعلم أو البريد الإلكتروني...">
            </div>
            <div style="display:flex;gap:8px;">
              <button class="btn btn--outline"><i class="fas fa-filter"></i> تصفية</button>
              <button class="btn btn--outline"><i class="fas fa-file-export"></i> تصدير</button>
              <button class="btn btn--school" id="add-teacher-btn" data-modal-open="teacher-modal"><i class="fas fa-plus"></i> إضافة معلم</button>
            </div>
          </div>
          
          <div class="table-wrap">
            <table class="data-table">
              <thead>
                <tr>
                  <th>الاسم</th>
                  <th>البريد الإلكتروني</th>
                  <th>التخصصات</th>
                  <th>عدد المجموعات</th>
                  <th>آخر نشاط</th>
                  <th>الحالة</th>
                  <th>الإجراءات</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><div style="display:flex;align-items:center;gap:8px;"><div style="width:32px;height:32px;background:#e0f2fe;color:#0369a1;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;">ن</div><div><div style="font-weight:600">نورة العلي</div><div style="font-size:11px;color:#6b7280">EMP-1023</div></div></div></td>
                  <td>nora.ali@school.edu</td>
                  <td>الرياضيات، الفيزياء</td>
                  <td>4</td>
                  <td>منذ ساعتين</td>
                  <td><span class="status-badge status-active">نشط</span></td>
                  <td>
                    <button class="btn-icon edit" title="تعديل" onclick="openEditModal('نورة العلي', 'nora.ali@school.edu', 'الرياضيات|الفيزياء')"><i class="fas fa-pen"></i></button>
                    <button class="btn-icon" title="صلاحيات" onclick="openPermissionsModal('نورة العلي')"><i class="fas fa-key"></i></button>
                    <button class="btn-icon delete" title="حذف"><i class="fas fa-trash"></i></button>
                  </td>
                </tr>
                <tr>
                  <td><div style="display:flex;align-items:center;gap:8px;"><div style="width:32px;height:32px;background:#fef3c7;color:#b45309;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;">أ</div><div><div style="font-weight:600">أحمد ياسين</div><div style="font-size:11px;color:#6b7280">EMP-1045</div></div></div></td>
                  <td>ahmed.yasin@school.edu</td>
                  <td>العلوم، الأحياء</td>
                  <td>3</td>
                  <td>أمس</td>
                  <td><span class="status-badge status-active">نشط</span></td>
                  <td>
                    <button class="btn-icon edit" title="تعديل" onclick="openEditModal('أحمد ياسين', 'ahmed.yasin@school.edu', 'العلوم|الأحياء')"><i class="fas fa-pen"></i></button>
                    <button class="btn-icon" title="صلاحيات" onclick="openPermissionsModal('أحمد ياسين')"><i class="fas fa-key"></i></button>
                    <button class="btn-icon delete" title="حذف"><i class="fas fa-trash"></i></button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Add Teacher Modal -->
  <div class="modal-overlay" id="teacher-modal" aria-hidden="true">
    <div class="modal">
      <div class="modal__header">
        <h2>إضافة معلم جديد</h2>
        <button class="modal__close" id="modal-close" data-modal-close>&times;</button>
      </div>
      <div class="modal__body">
        <div class="form-group">
          <label>الاسم الكامل</label>
          <input type="text" id="teacher-name" placeholder="مثال: أحمد ياسين">
        </div>
        <div class="form-group">
          <label>البريد الإلكتروني</label>
          <input type="email" id="teacher-email" placeholder="email@school.edu">
        </div>
        <div class="form-group">
          <label>التخصصات (يمكن اختيار أكثر من مادة)</label>
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px; margin-top:4px;">
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="teacher-subjects" value="الرياضيات"> الرياضيات
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="teacher-subjects" value="الفيزياء"> الفيزياء
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="teacher-subjects" value="العلوم"> العلوم
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="teacher-subjects" value="الأحياء"> الأحياء
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="teacher-subjects" value="اللغة الإنجليزية"> اللغة الإنجليزية
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="teacher-subjects" value="اللغة العربية"> اللغة العربية
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="teacher-subjects" value="التاريخ"> التاريخ
            </label>
          </div>
        </div>
        <div class="form-group">
          <label>الصفوف التي يدرسها</label>
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px; margin-top:4px;">
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="teacher-grades" value="السابع"> الصف السابع
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="teacher-grades" value="الثامن"> الصف الثامن
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="teacher-grades" value="التاسع"> الصف التاسع
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="teacher-grades" value="العاشر"> الصف العاشر
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="teacher-grades" value="الحادي عشر"> الحادي عشر
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="teacher-grades" value="الثاني عشر"> الثاني عشر
            </label>
          </div>
        </div>
      </div>
      <div class="modal__footer">
        <button class="btn btn--outline" id="modal-cancel" data-modal-close>إلغاء</button>
        <button class="btn btn--school" id="modal-save">حفظ</button>
      </div>
    </div>
  </div>

  <!-- Edit Teacher Modal -->
  <div class="modal-overlay" id="edit-teacher-modal" aria-hidden="true">
    <div class="modal">
      <div class="modal__header">
        <h2>تعديل بيانات المعلم</h2>
        <button class="modal__close" data-modal-close>&times;</button>
      </div>
      <div class="modal__body">
        <div class="form-group">
          <label>الاسم الكامل</label>
          <input type="text" id="edit-teacher-name">
        </div>
        <div class="form-group">
          <label>البريد الإلكتروني</label>
          <input type="email" id="edit-teacher-email">
        </div>
        <div class="form-group">
          <label>التخصصات (يمكن اختيار أكثر من مادة)</label>
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px; margin-top:4px;">
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="edit-teacher-subjects" value="الرياضيات"> الرياضيات
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="edit-teacher-subjects" value="الفيزياء"> الفيزياء
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="edit-teacher-subjects" value="العلوم"> العلوم
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="edit-teacher-subjects" value="الأحياء"> الأحياء
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="edit-teacher-subjects" value="اللغة الإنجليزية"> اللغة الإنجليزية
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="edit-teacher-subjects" value="اللغة العربية"> اللغة العربية
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:6px; cursor:pointer;">
              <input type="checkbox" name="edit-teacher-subjects" value="التاريخ"> التاريخ
            </label>
          </div>
        </div>
      </div>
      <div class="modal__footer">
        <button class="btn btn--outline" data-modal-close>إلغاء</button>
        <button class="btn btn--school" onclick="saveEditTeacher()">حفظ التغييرات</button>
      </div>
    </div>
  </div>

  <!-- Permissions Modal -->
  <div class="modal-overlay" id="permissions-modal" aria-hidden="true">
    <div class="modal">
      <div class="modal__header">
        <h2>صلاحيات المعلم: <span id="perm-teacher-name"></span></h2>
        <button class="modal__close" data-modal-close>&times;</button>
      </div>
      <div class="modal__body">
        <div class="form-group">
          <label style="margin-bottom:8px">الصلاحيات المتاحة</label>
          <div style="display:grid; gap:8px;">
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:8px; cursor:pointer; padding:8px; background:#f9fafb; border-radius:4px;">
              <input type="checkbox" checked> إنشاء وتعديل الاختبارات
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:8px; cursor:pointer; padding:8px; background:#f9fafb; border-radius:4px;">
              <input type="checkbox" checked> رصد الدرجات
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:8px; cursor:pointer; padding:8px; background:#f9fafb; border-radius:4px;">
              <input type="checkbox"> إدارة جداول الحصص
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:8px; cursor:pointer; padding:8px; background:#f9fafb; border-radius:4px;">
              <input type="checkbox"> التواصل مع أولياء الأمور
            </label>
            <label style="font-weight:400; font-size:13px; display:flex; align-items:center; gap:8px; cursor:pointer; padding:8px; background:#f9fafb; border-radius:4px;">
              <input type="checkbox"> الاطلاع على التقارير الإدارية
            </label>
          </div>
        </div>
      </div>
      <div class="modal__footer">
        <button class="btn btn--outline" data-modal-close>إلغاء</button>
        <button class="btn btn--school" onclick="savePermissions()">حفظ الصلاحيات</button>
      </div>
    </div>
  </div>

  <script src="shared-layout.js"></script>
  <script>
    function collectCheckedValues(selector) {
      var values = [];
      var items = document.querySelectorAll(selector);
      items.forEach(function (item) {
        if (item.checked) values.push(item.value);
      });
      return values;
    }

    function setCheckedValues(selector, values) {
      var normalized = values || [];
      var items = document.querySelectorAll(selector);
      items.forEach(function (item) {
        item.checked = normalized.indexOf(item.value) !== -1;
      });
    }

    function clearCheckedValues(selector) {
      var items = document.querySelectorAll(selector);
      items.forEach(function (item) {
        item.checked = false;
      });
    }

    (function(){
      // Shared layout handles opening/closing via data attributes
      var modal = document.getElementById('teacher-modal');
      var saveBtn = document.getElementById('modal-save');
      var closeBtn = document.getElementById('modal-close'); // For manual close if needed

      // We still need to handle the specific Save logic
      saveBtn.addEventListener('click', function() {
        var name = document.getElementById('teacher-name').value.trim();
        var selectedSubjects = collectCheckedValues('input[name="teacher-subjects"]');
        
        // Collect selected grades
        var selectedGrades = collectCheckedValues('input[name="teacher-grades"]');

        if(name && selectedSubjects.length > 0 && selectedGrades.length > 0) {
          alert(
            'تم إضافة المعلم: ' + name
            + '\nالتخصصات: ' + selectedSubjects.join(', ')
            + '\nالصفوف: ' + selectedGrades.join(', ')
          );
          document.getElementById('teacher-name').value = '';
          document.getElementById('teacher-email').value = '';
          clearCheckedValues('input[name="teacher-subjects"]');
          clearCheckedValues('input[name="teacher-grades"]');
          // Manually close using shared layout class/attr logic or click the close button mock
          closeBtn.click();
        } else {
          alert('يرجى إدخال الاسم واختيار مادة واحدة على الأقل وصف واحد على الأقل');
        }
      });
    })();

    // Functions for Edit/Permissions Modals
    function openEditModal(name, email, subjects) {
      document.getElementById('edit-teacher-name').value = name;
      document.getElementById('edit-teacher-email').value = email;
      var subjectList = String(subjects || '')
        .split('|')
        .map(function (item) { return item.trim(); })
        .filter(function (item) { return item.length > 0; });
      setCheckedValues('input[name="edit-teacher-subjects"]', subjectList);
      
      var modal = document.getElementById('edit-teacher-modal');
      modal.classList.add('modal-overlay--active');
      modal.setAttribute('aria-hidden', 'false');
    }

    function saveEditTeacher() {
      var selectedSubjects = collectCheckedValues('input[name="edit-teacher-subjects"]');
      if (!selectedSubjects.length) {
        alert('يرجى اختيار مادة واحدة على الأقل للمعلم');
        return;
      }

      alert('تم حفظ التغييرات بنجاح\nالتخصصات: ' + selectedSubjects.join(', '));
      var modal = document.getElementById('edit-teacher-modal');
      modal.classList.remove('modal-overlay--active');
      modal.setAttribute('aria-hidden', 'true');
    }

    function openPermissionsModal(name) {
      document.getElementById('perm-teacher-name').textContent = name;
      
      var modal = document.getElementById('permissions-modal');
      modal.classList.add('modal-overlay--active');
      modal.setAttribute('aria-hidden', 'false');
    }

    function savePermissions() {
      alert('تم تحديث الصلاحيات بنجاح');
      var modal = document.getElementById('permissions-modal');
      modal.classList.remove('modal-overlay--active');
      modal.setAttribute('aria-hidden', 'true');
    }
    (function(){
       // Re-init modals for dynamically added ones if needed, though raw onclick handles open
       // shared-layout.js handles the close buttons via data-modal-close
    })();
  </script>
</body>
</html>
